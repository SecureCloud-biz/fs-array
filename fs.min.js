(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.fs={})})(this,function(exports){"use strict";const fs=require("fs");const path=require("path");const{homedir:homedir,tmpdir:tmpdir}=require("os");const{promisify:promisify}=require("util");const magic=require("magic-promises");const run=require("atocha");const mac=()=>process.platform==="darwin";const linux=()=>process.platform==="linux";const abs=(name=".",base=process.cwd())=>{if(path.isAbsolute(name))return name;if(!base||typeof base!=="string"){base=process.cwd()}return join(base,name)};const cat=name=>{const file=abs(name);const readFile=promisify(fs.readFile);return magic(readFile(file,"utf-8"))};const dir=name=>path.dirname(abs(name));const exists=name=>{const file=abs(name);const exists=promisify(fs.exists);return magic(exists(file))};const join=(...args)=>abs(path.join(...args));const list=name=>{const file=abs(name);const readDir=promisify(fs.readdir);return magic(readDir(file)).map(name=>join(file,name))};const mkdir=name=>{const file=abs(name);const realmkdir=promisify(fs.mkdir);return magic(file.split(path.sep).map((part,i,all)=>{return all.slice(0,i+1).join(path.sep)}).filter(Boolean).reduce((prom,path)=>{return prom.then(async()=>await exists(path)?path:realmkdir(path)).catch(err=>{}).then(()=>file)},Promise.resolve()))};const name=path.basename;const remove=name=>magic([abs(name)]).map(async file=>{if(file==="/")throw new Error("Cannot remove the root folder `/`");if(!await exists(file))return file;const stats=await stat(file);if(stats&&stats.isDirectory()){const files=await walk(file).map(remove);await list(file).map(remove);await promisify(fs.rmdir)(file).catch(err=>{});return file}await promisify(fs.unlink)(file).catch(err=>{});return file})[0];const stat=name=>{const file=abs(name);const lstat=promisify(fs.lstat);return magic(lstat(file)).catch(err=>{})};const tmp=(...args)=>mkdir(join(tmpdir(),...args));const rWalk=name=>{const file=abs(name);const deepper=async file=>{if((await stat(file)).isDirectory()){return rWalk(file)}return[file]};return list(file).map(deepper).reduce((all,arr)=>all.concat(arr),[])};const walk=name=>magic(exists(abs(name)).then(isThere=>{if(!isThere)return magic([]);if(linux()||mac()){return run(`find ${abs(name)} -type f`).split("\n").filter(Boolean)}return rWalk(abs(name)).filter(Boolean)}));const write=(name,body="")=>{const file=abs(name);const writeFile=promisify(fs.writeFile);return magic(writeFile(file,body,"utf-8").then(()=>file))};exports.abs=abs;exports.cat=cat;exports.dir=dir;exports.exists=exists;exports.join=join;exports.list=list;exports.ls=list;exports.mkdir=mkdir;exports.name=name;exports.read=cat;exports.remove=remove;exports.stat=stat;exports.tmp=tmp;exports.walk=walk;exports.write=write;Object.defineProperty(exports,"__esModule",{value:true})});