(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.fs={})})(this,function(exports){"use strict";const fs=require("fs");const path=require("path");const{homedir:homedir,tmpdir:tmpdir}=require("os");const{promisify:promisify}=require("util");const magic=require("magic-promises");const run=require("atocha");const mac=()=>process.platform==="darwin";const linux=()=>process.platform==="linux";const abs=(name=".",base=process.cwd())=>magic((async()=>{name=await name;base=await base;if(path.isAbsolute(name))return name;if(!base||typeof base!=="string"){base=process.cwd()}return join(base,name)})());const readFile=file=>promisify(fs.readFile)(file,"utf-8");const cat=name=>magic(abs(name).then(readFile).catch(err=>""));const dirFlat=file=>path.dirname(file);const dir=name=>magic(abs(name).then(dirFlat));const existsAsync=promisify(fs.exists);const existsFlat=file=>existsAsync(file);const exists=name=>magic(abs(name).then(existsFlat).catch(res=>res));const home=(...args)=>magic(join(homedir(),...args).then(mkdir));const joinFlat=parts=>path.join(...parts);const join=(...parts)=>abs(magic(parts).then(joinFlat));const list=dir=>{const readDir=promisify(fs.readdir);return magic([dir]).map(abs).map(file=>readDir(file)).shift().map(file=>abs(file,dir))};const mkdir=name=>{const file=abs(name);const realmkdir=promisify(fs.mkdir);return magic(file.split(path.sep).map((part,i,all)=>{return all.slice(0,i+1).join(path.sep)}).filter(Boolean).reduce((prom,path)=>{return prom.then(async()=>await exists(path)?path:realmkdir(path)).catch(err=>{}).then(()=>file)},Promise.resolve()))};const nameFlat=path.basename;const name=file=>magic(magic(file).then(nameFlat));const remove=name=>magic([abs(name)]).map(async file=>{if(file==="/")throw new Error("Cannot remove the root folder `/`");if(!await exists(file))return file;const stats=await stat(file);if(stats&&stats.isDirectory()){const files=await walk(file).map(remove);await list(file).map(remove);await promisify(fs.rmdir)(file).catch(err=>{});return file}await promisify(fs.unlink)(file).catch(err=>{});return file})[0];const statAsync=promisify(fs.lstat);const stat=name=>magic(abs(name).then(statAsync).catch(err=>{}));const tmp=(...args)=>abs(join(tmpdir(),...args).then(mkdir));const rWalk=name=>{const file=abs(name);const deepper=async file=>{if((await stat(file)).isDirectory()){return rWalk(file)}return[file]};return list(file).map(deepper).reduce((all,arr)=>all.concat(arr),[])};const walk=name=>magic(exists(name).then(async isThere=>{if(!isThere)return magic([]);if(linux()||mac()){return run(`find ${await abs(name)} -type f`).split("\n").filter(Boolean)}return rWalk(abs(name)).filter(Boolean)}));const write=(name,body="")=>{const file=abs(name);const writeFile=promisify(fs.writeFile);return magic(writeFile(file,body,"utf-8").then(()=>file))};exports.abs=abs;exports.cat=cat;exports.dir=dir;exports.exists=exists;exports.home=home;exports.join=join;exports.list=list;exports.ls=list;exports.mkdir=mkdir;exports.name=name;exports.read=cat;exports.remove=remove;exports.stat=stat;exports.tmp=tmp;exports.walk=walk;exports.write=write;Object.defineProperty(exports,"__esModule",{value:true})});